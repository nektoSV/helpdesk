!function(){"use strict";var t=async(t={})=>{let e=new XMLHttpRequest;const{method:i,url:s,data:c,callback:d}=t,a="http://localhost:3000";e.responseType="text";try{"GET"===i?(e.open(i,a+s),e.send()):(e.open(i,a+s),e.send(JSON.stringify(c)))}catch(t){d&&d(t)}e.addEventListener("load",(()=>{if(e.status>=200&&e.status<300)try{const t=JSON.parse(e.responseText);d(t)}catch(t){console.error(t)}}))};class e{list(e){t({method:"GET",url:"?method=allTickets",callback:e})}get(e,i){t({method:"GET",url:`?method=ticketById&id=${e.id}`,data:e,callback:i})}create(e,i){t({method:"POST",url:"?method=createTicket",data:e,callback:i})}update(e,i){t({method:"POST",url:`?method=updateById&id=${e.id}`,data:e,callback:i})}delete(e,i){t({method:"GET",url:`?method=deleteById&id=${e.id}`,data:e,callback:i})}}class i{constructor(t){this.target=t}createForm(t){const e=document.createElement("form"),i=document.createElement("h2"),s=document.createElement("div"),c=document.createElement("div"),d=document.createElement("label"),a=document.createElement("label"),n=document.createElement("input"),o=document.createElement("input"),l=document.createElement("div"),r=document.createElement("button"),m=document.createElement("button");if(n.id="short-description",o.id="detailed-description",n.name="name",o.name="description",d.for="short-description",a.for="detailed-description",e.classList.add("form"),i.classList.add("form-title"),s.classList.add("form-short-description"),c.classList.add("form-detailed-description"),n.classList.add("input"),o.classList.add("input"),n.classList.add("short-description"),o.classList.add("detailed-description"),l.classList.add("buttons"),r.classList.add("btn"),r.classList.add("btn-form"),r.classList.add("btn-add"),m.classList.add("btn"),m.classList.add("btn-form"),m.classList.add("btn-close"),e.enctype="multipart/form-data",n.type="text",o.type="text",r.type="submit",d.textContent="Краткое описание",a.textContent="Подробное описание",r.textContent="Ok",m.textContent="Отмена",t){const s=t.querySelector(".ticket-name"),c=t.querySelector(".description");i.textContent="Изменить тикет",e.classList.add("form-update"),n.value=s.textContent,o.value=c.textContent}else i.textContent="Добавить тикет",e.classList.add("form-add"),n.value="",o.value="";r.addEventListener("click",this.target.onClick),m.addEventListener("click",this.target.onClick),e.appendChild(i),s.appendChild(d),s.appendChild(n),c.appendChild(a),c.appendChild(o),e.appendChild(s),e.appendChild(c),l.appendChild(r),l.appendChild(m),e.appendChild(l),this.target.container.appendChild(e)}createConfirmation(){const t=document.createElement("div"),e=document.createElement("h2"),i=document.createElement("p"),s=document.createElement("div"),c=document.createElement("button"),d=document.createElement("button");t.classList.add("confirmation"),t.classList.add("form"),e.classList.add("confirmation-title"),i.classList.add("confirmation-text"),s.classList.add("buttons"),c.classList.add("btn"),c.classList.add("btn-ok"),c.classList.add("confirmation-btn"),d.classList.add("btn"),d.classList.add("btn-close"),d.classList.add("confirmation-btn"),e.textContent="Удалить тикет",i.textContent="Вы уверены, что хотите удалить тикет? Это действие необратимо.",c.textContent="Ok",d.textContent="Отмена",c.addEventListener("click",this.target.onClick),d.addEventListener("click",this.target.onClick),s.appendChild(c),s.appendChild(d),t.appendChild(e),t.appendChild(i),t.appendChild(s),this.target.container.appendChild(t)}close(t){t.target.closest(".form").remove()}}class s{constructor(t){this.target=t}create(t){const e=document.querySelector(".tickets-list");t&&t.forEach((t=>{const i=document.createElement("div"),s=document.createElement("div"),c=document.createElement("div"),d=document.createElement("p"),a=document.createElement("div"),n=document.createElement("time"),o=document.createElement("button"),l=document.createElement("button"),r=document.createElement("div");i.id=t.id,c.id=t.status,n.id=t.created,i.classList.add("ticket"),s.classList.add("main"),r.classList.add("description"),r.classList.add("hidden"),c.classList.add("btn"),c.classList.add("ticket-btn"),c.classList.add("ticket-status"),c.classList.add(`${t.status}`),d.classList.add("ticket-name"),a.classList.add("info"),n.classList.add("ticket-date"),o.classList.add("btn"),l.classList.add("btn"),o.classList.add("ticket-btn"),l.classList.add("ticket-btn"),o.classList.add("ticket-create"),l.classList.add("ticket-delete"),d.textContent=t.name,n.textContent=new Date(Number(t.created)).toLocaleTimeString("ru-RU",{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit"}),r.textContent=t.description,i.addEventListener("click",this.target.onClick),i.appendChild(s),i.appendChild(r),a.appendChild(n),a.appendChild(o),a.appendChild(l),s.appendChild(c),s.appendChild(d),s.appendChild(a),e.appendChild(i)}))}}class c{constructor({id:t,name:e,description:i,status:s,created:c}){this.id=t,this.name=e,this.description=i,this.status=s,this.created=c}}const d=document.getElementById("root");new class{constructor(t){if(!(t instanceof HTMLElement))throw new Error("This is not HTML element!");this.container=t,this.activTicket=null,this.ticketService=new e,this.ticketForm=new i(this),this.ticketView=new s(this),this.onClick=this.onClick.bind(this)}init(){const t=document.createElement("button"),e=document.createElement("div");t.classList.add("btn"),t.classList.add("button-create"),e.classList.add("tickets-list"),t.textContent="Добавить тикет",t.addEventListener("click",this.onClick),this.container.appendChild(t),this.container.appendChild(e),this.ticketService.list((t=>{t&&this.ticketView.create(t)}))}onClick(t){t.preventDefault();const e=t.target,i=e.closest(".ticket"),s=e.closest(".form"),c=e.closest(".confirmation");if(e.className.includes("create")){const t=document.querySelector(".form");i?(t&&t.remove(),this.activTicket=i,this.ticketForm.createForm(i)):(t&&t.remove(),this.ticketForm.createForm())}else{if(e.className.includes("delete")){const t=document.querySelector(".form");return t&&t.remove(),this.activTicket=i,void this.ticketForm.createConfirmation()}if(e.className.includes("ok"))this.removeTicket(c);else if(e.className.includes("add"))s.className.includes("add")?this.addTicket(s):this.updateTicket(s);else{if(e.className.includes("status"))return e.className.includes("false")?(e.classList.remove("false"),e.classList.add("true"),e.id="true"):(e.classList.remove("true"),e.classList.add("false"),e.id="false"),void this.updateStatus(i);if(e.className.includes("close"))s.remove();else if(e&&i){const t=i.querySelector(".description");t.className.includes("hidden")?t.classList.remove("hidden"):t.classList.add("hidden")}}}}addTicket(t){const e=t.querySelector("#short-description"),i=t.querySelector("#detailed-description"),s={name:e.value,description:i.value};this.ticketService.create(s,(e=>{e&&(t.remove(),this.ticketView.create([e]))}))}updateTicket(t){const e=t.querySelector("#short-description"),i=t.querySelector("#detailed-description"),s=this.activTicket.querySelector(".ticket-status"),d=this.activTicket.querySelector(".ticket-date"),a=new c({id:this.activTicket.id,name:e.value,description:i.value,status:s.id,created:d.id});this.ticketService.update(a,(e=>{e&&(t.remove(),this.activTicket=null,document.querySelectorAll(".ticket").forEach((t=>t.remove())),this.ticketView.create(e))}))}updateStatus(t){const e=t.querySelector(".ticket-name"),i=t.querySelector(".ticket-status"),s=t.querySelector(".description"),d=t.querySelector(".ticket-date"),a=new c({id:t.id,name:e.textContent,description:s.textContent,status:i.id,created:Date.now(d.textContent)});this.ticketService.update(a,(t=>{t&&(document.querySelectorAll(".ticket").forEach((t=>t.remove())),this.ticketView.create(t))}))}removeTicket(t){const e=this.activTicket.querySelector(".ticket-name"),i=this.activTicket.querySelector(".description"),s=this.activTicket.querySelector(".ticket-status"),d=this.activTicket.querySelector(".ticket-date"),a=new c({id:this.activTicket.id,name:e.textContent,description:i.textContent,status:s.id,created:d.id});this.ticketService.delete(a,t.remove()),this.activTicket.remove(),this.activTicket=null}}(d).init()}();